<html><head><meta  content="text/html; charset=utf-8" http-equiv="Content-Type"\><style type="text/css">body{margin:0px;font-size:12px;font-family:微软雅黑;}p{text-indent:25px;}pre{font-size:14px;font-family:Consolas;}script{font-size:14px;font-family:Consolas;}.topbox{width:100%;background:#aaa;height:20px;}.top{margin-right:auto;height:20px;margin-left:auto;background:#aaa;width:1100px;}.topleft{width:300px;float:left;height:20px;}.topright{width:300px;float:right;text-align:right;height:20px;}.center{width:1100px;clear:both;margin:auto;height:auto;}.logo{width:1100px;background:#9cf;height:100px;}.navi{color:#6cc;width:1100px;height:30px;margin-top:2px;margin-bottom:2px;}.navi_item{margin-right:10px;float:left;text-align:center;height:28px;width:100px;line-height:30px;border:1px solid;}.crumbs{width:1090px;padding-left:10px;background:#6c9;height:20px;}.main_table{width:1100px;vertical-align:top;height:auto;}.main{width:1100px;height:auto;}.left{width:300px;float:left;height:1000px;}.right{width:790px;float:left;font-size:20px;height:auto;}.bottombox{width:100%;float:left;background:#9cf;height:100px;}</style><style type="text/css">.code{overflow:auto;margin:0px;display:block;}.code_line1{background:#ccc;}.code_line2{background:#aca;}.code_key{color:#00a;font-weight:bold;}.code_interpreter{color:#aaa;font-weight:bold;}.code_comment{color:#0a0;font-weight:bold;}.code_plain{color:#000;}.code_str{color:#900;}</style><title>code</title></head><body><div class="topbox"><div class="top"><div class="topleft">welcome</div><div class="topright">add to fav</div></div></div><div class="center"><div class="logo"><a href="/"><img  src="/static/img/logo.jpg"\></a></div><div class="navi"><div class="navi_item"><a href="/blog/cpp/">cpp</a></div><div class="navi_item"><a href="/blog/python/">python</a></div><div class="navi_item"><a href="/blog/lenovo/">lenovo</a></div><div class="navi_item"><a href="/blog/openstack/">openstack</a></div></div><div class="crumbs"><a href="/">首页</a></div><table class="main_table"><tr class="main_table"><td width="302px" style="background: #cff"><div class="left"></div></td><td width="792px"><div class="right"><div class="code"><pre style="display:inline-block;"><ol><div style="width: 800px;"></div><li class="code_line1"><span class="code_key">import </span><span class="code_plain">os</span></li><li class="code_line2"><span class="code_key">import </span><span class="code_plain">time</span></li><li class="code_line1"><span class="code_key">import </span><span class="code_plain">threading</span></li><li class="code_line2"><span class="code_key">from </span><span class="code_plain">oslo_log </span><span class="code_key">import </span><span class="code_plain">log </span><span class="code_key">as </span><span class="code_plain">logging</span></li><li class="code_line1"><span class="code_plain">LOG </span><span class="code_plain">= </span><span class="code_plain">logging.getLogger(__name__)</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_key">class </span><span class="code_plain">RemoteShell:</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">_lock_known_hosts </span><span class="code_plain">= </span><span class="code_plain">threading.Lock()</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">__init__(self, </span><span class="code_plain">host, </span><span class="code_plain">user, </span><span class="code_plain">pwd):</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self.host </span><span class="code_plain">= </span><span class="code_plain">host</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self.user </span><span class="code_plain">= </span><span class="code_plain">user</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self.pwd </span><span class="code_plain">= </span><span class="code_plain">pwd</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self.cur_cmd </span><span class="code_plain">= </span><span class="code_key">None</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self.expect_pwd </span><span class="code_plain">= </span><span class="code_plain">[</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_str">'expect {'</span><span class="code_plain">,</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_str">'"(yes/no)?"\n{send "yes\n"; exp_continue}'</span><span class="code_plain">,</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_str">'"*assword:"\n{send "%s\n"; exp_continue}'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">self.pwd,</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_str">'"No such file or directory"\n{exit -1}'</span><span class="code_plain">,</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_str">'"eof"\n{exit}'</span><span class="code_plain">,</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_str">'}'</span><span class="code_plain">,</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">]</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">_make_expect(self, </span><span class="code_plain">cmd):</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self.cur_cmd </span><span class="code_plain">= </span><span class="code_plain">cmd</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">LOG.info(</span><span class="code_str">'RemoteShell: %s'</span><span class="code_plain">, </span><span class="code_plain">cmd)</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">filename </span><span class="code_plain">= </span><span class="code_plain"></span><span class="code_str">'expect.%s.%s.cmd'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">(self.host, </span><span class="code_plain">time.time())</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f </span><span class="code_plain">= </span><span class="code_plain">open(filename, </span><span class="code_plain"></span><span class="code_str">'w'</span><span class="code_plain">)</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f.write(</span><span class="code_str">'#!/usr/bin/expect\nset timeout -1\n'</span><span class="code_plain">)</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f.write(</span><span class="code_str">'spawn %s\n'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">cmd)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">for </span><span class="code_plain">item </span><span class="code_key">in </span><span class="code_plain">self.expect_pwd:</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f.write(item)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f.write(</span><span class="code_str">'\n'</span><span class="code_plain">)</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f.write(</span><span class="code_str">'exit\n'</span><span class="code_plain">)</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">f.close()</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">return </span><span class="code_plain">filename</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">_do_expect(self, </span><span class="code_plain">cmd):</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">filename </span><span class="code_plain">= </span><span class="code_plain">self._make_expect(cmd)</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">r </span><span class="code_plain">= </span><span class="code_plain">-1</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">cmd </span><span class="code_plain">= </span><span class="code_plain"></span><span class="code_str">'expect %s'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">filename</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">for </span><span class="code_plain">i </span><span class="code_key">in </span><span class="code_plain">range(5):</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">r </span><span class="code_plain">= </span><span class="code_plain">os.system(cmd </span><span class="code_plain">+ </span><span class="code_plain"></span><span class="code_str">' >> /var/log/storagemgmt/expect.%s.log'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">self.host)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">if </span><span class="code_plain">r </span><span class="code_plain">== </span><span class="code_plain">0:</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">os.remove(filename)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">return</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">else:</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">LOG.error(</span><span class="code_str">'RemoteShell execute {%s} [ctxt: %s] fail! Retry(%s)...'</span><span class="code_plain">, </span><span class="code_plain">cmd, </span><span class="code_plain">self.cur_cmd, </span><span class="code_plain">i)</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">raise </span><span class="code_plain">Exception(</span><span class="code_str">"execute cmd fail[%s](%s)!"</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">(cmd, </span><span class="code_plain">r))</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">_remove_known_host(self):</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"></span><span class="code_comment"># Avoid offending key with old record
</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">r </span><span class="code_plain">= </span><span class="code_plain">-1</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">try:</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self._lock_known_hosts.acquire()</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">r </span><span class="code_plain">= </span><span class="code_plain">os.system(</span><span class="code_str">"sed -i '/%s/d' /root/.ssh/known_hosts"</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">self.host)</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">except </span><span class="code_plain">Exception </span><span class="code_key">as </span><span class="code_plain">e:</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">LOG.error(</span><span class="code_str">'RemoteShell _remove_known_host fail! (r=%s)(err=%s)'</span><span class="code_plain">, </span><span class="code_plain">r, </span><span class="code_plain">e)</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">raise </span><span class="code_plain">Exception(</span><span class="code_str">"RemoteShell _remove_known_host fail!"</span><span class="code_plain">)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">finally:</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self._lock_known_hosts.release()</span></li><li class="code_line1"><span class="code_plain"></span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">put(self, </span><span class="code_plain">local_path, </span><span class="code_plain">remote_path):</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self._remove_known_host()</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">cmd </span><span class="code_plain">= </span><span class="code_plain"></span><span class="code_str">'scp %s %s@%s:%s'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">(os.path.expanduser(local_path), </span><span class="code_plain">self.user, </span><span class="code_plain">self.host, </span><span class="code_plain">remote_path)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self._do_expect(cmd)</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">get(self, </span><span class="code_plain">remote_path, </span><span class="code_plain">local_path):</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">cmd </span><span class="code_plain">= </span><span class="code_plain"></span><span class="code_str">'scp %s@%s:%s %s'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">(self.user, </span><span class="code_plain">self.host, </span><span class="code_plain">remote_path, </span><span class="code_plain">os.path.expanduser(local_path))</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self._do_expect(cmd)</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_key">def </span><span class="code_plain">execute(self, </span><span class="code_plain">cmd):</span></li><li class="code_line2"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">cmd </span><span class="code_plain">= </span><span class="code_plain"></span><span class="code_str">'ssh %s@%s %s'</span><span class="code_plain"> </span><span class="code_plain">% </span><span class="code_plain">(self.user, </span><span class="code_plain">self.host, </span><span class="code_plain">cmd)</span></li><li class="code_line1"><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain"> </span><span class="code_plain">self._do_expect(cmd)</span></li><li class="code_line2"><span class="code_plain"></span></li><li class="code_line1"><span class="code_plain"></span><span class="code_comment"># a = RemoteShell(host="10.20.0.10", user="root", pwd="lenovo")
</span></li><li class="code_line2"><span class="code_plain"></span><span class="code_comment"># a.put("/tmp/InstallCeph-suse12.tar.gz","/tmp/InstallCeph-suse12.tar.gz")
</span></li></ol></pre></div></div></td></tr></table></div><div class="bottombox"></div></body></html>